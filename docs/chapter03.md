3장
- https://github.com/Youngerjesus/refactoring-2nd-edition/blob/master/document/chapter-03/README.md

영상 정리

featur envy
- 토비님은 비지터 패턴은 사용한거 거의 못봄
  - 비지터 패턴은 더블 디스패치에 활용
    - 다형성이 양방향으로 필요할때 사용
- 자바나 코틀린은 싱글 디스패치

좋은 이름이 떠오르지 않는다면 다른 종류의 리팩토링이 필요하다
- 하나의 일을 하는게 맞는지

뒤엉킨 변경

메서드 추출 기준은 무엇을 할것인지와 어떻게 할것인가의 의미가 너무 멀어지지 않도록 함수를 추출
- 무엇을: 메서드 함수
- 어떻게: 메서드 내의 내용

메서드에 주석을 달고 싶으면 메서드 추출하기 딱 좋은 신호

긴 함수 쪼깰때
- 조건문, 루프, 스위치는 쪼개기 권장
  - 특히 조건문

메시지 체이닝과 중계자 리팩터링(위임)은 잘 어울림
- OOP 진영에서 디미터 법칙으로 인해 중계자 리팩터링이 더 선호된다

dto를 메시지 체이닝 하는건 괜찮음
비즈니스 로직에서 체이닝이 생기면 개선할 필요가 있다

```java
member.getRole().hasPermission(ADMIN)
```
- 이정도는 충분히 괜찮다
  - ROLE이 다양하게 쓰이면 위와같이
- 아니면 ROLE이 활용성이 없으면 >> 처럼 하기`member.isAdmin()`
즉, 사용되어지는 맥락이 중요

중계자 오브젝트가 위임'만' 하면 제거를 고려하자

함수를 쪼갰더니 전체 코드가 더 이해하기 어려운 경우가 있다?
- 쪼개기 전에가 더 좋았나? 그건 아닐꺼다
- 쪼개지는 함수 레벨의 추상화가 제각각이면 이해하기 어렵다
  - 이메일 체크 -> 주문 총합 계산 -> 엑셀 다운 
    - 이런식으로 되어있느게 추상화 레벨이 짬뽕쓰
    - "A Philosophy of Software Design" 책
      - 추상화의 품질을 복잡성의 비율로 측정하는 것이 핵심임

도메인 객체에 바로 넣기보다는 설계가 제대로 된건가? 고민
- 도메인 중간에 조건에 따라 디비 조회, 외부 API 호출가 필요할때가 있음
  - 준비된채로 처음 시작될 수 있따 << 먼저 조회 후 메서드에 넘겨주기
  - 그게 아니라 동적으로 조건에 따라 적용해야 한다면 도메인 서비스로 만들기 
    - 진행중인 이벤트 중 주문과 관련된 등등
  - 도메인 서비스는 domain 레이어에 인터페이스로 정의 후 도메인 메서드 안으로 인터페이스 타입을 건네줌
    - 구현은 상태를 안가지므로 스프링 빈으로 만듬
      - 외부 의존성을 주입받아도 됨
    - 하나의 엔티티에만 적용할때
    - 인터페이스를 쓰기 때문에 신경 안써도 됨
  - 간혹 도메인 서비스 안의 메서드에 엔티티를 주는게 낳을때도 있음
    - 외부의 정책이나 조건에 따라 다를때 ㄱㄱ, 엔티티가 두개
      - ex) 은행 계좌 이체(보낼계좌, 받을계좌 두개의 Account 오브젝트를 도메인 서비스에 넘겨줌)
  - 도메인 서비스는 서비스 계층에서 빈으로 받음
  - 도메인 서비스는 상태를 가지지 않는 스테인리스 오브젝트로 만듬
  - 인터페이스 까지만 도메인임
    - 인터페이스에 대한 구현은 보통 밖으로 빠짐
      - 동적으로 바뀔때(repository 등)
    - 그러나, validater 같은경우는 도메인 레이어에 실제 구현까지 다 들어갈 수 있음(정책이 픽스일때) 
  - 기본적으로 모든 도메인 서비스는 인터페이스만 바라보고 코드를 작성
  - 도메인의 핵심적인 규칙이나 로직들을 가져다 쓰꼬 동적으로 변경되면 도메인 서비스를 적극적으로 활용
  - 도메인 서비스 ddd에서 나오는 도메인 서비스
  - 3가지 서비스
    - 애플리케이션 서비스(퍼사드)
     - 뒤 도메인 로직을 호출
     - 복잡한 로직이 안들어감
     - 가끔 repository 같은거 사용
  - 도메인 서비스
    - 하나의 엔티티안에 넣기가 애매한 로직들
    - 엔티티가 너무 방대해져서 일부러 분리하기 좋을때 상태를 가지지 않는 서비스
  - 테크니컬 서비스
    - 인프라 레이어에 들어 있는것
      - 이메일 서비스, 데이터베이스 처리하는 것들 등등

주석
- 주석은 무조껀 나쁜건 아니다
  - 클린코드 잘못 읽은 사람들이 이렇게 말함
- 디어도런트로 쓰이는 주석은 나쁨
- 이름을 잘 짓고 리팩토링을 잘해도 미래의 코드를 볼때 잘 이해가 안되는게 있을떄 주석 사용(기술적인 기법 등)
- 내가 지금 무엇을 해야 할지 잘 모를때 주석을 달기(미래의 내가 다시 볼때 확실히 기억을 해야 할 때)
- 레이어가 시작하는 단계의 인터페이스에는 주석을 달기
  - 메서드이름만 가지고 어떻게 사용해야 하는지 모름, 코드 언제 다 찾아보냐
  - public 메서드에는 달기
  - 코드를 고쳤는데 주석을 업데이트 안하면 안되는데.. 이게 딜레마임
  - 그래도 주석을 달아야 함
    - 명확하지 않은 코드로 인해 낭비한 시간이 많음
      - 필요한 부분에 풍부한 주석을 달아 “왜 이런 방식으로 구현하는지” 설명함
        - 주석으로 주요 변수(multiples, primes)의 의도와 알고리즘 동작 방식을 함께 서술해, 코드 이해를 빠르게 돕고자 함
- 어려운 영어 이름에 한글로 주석을 달아 주자